!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("groupchat-receipts",["exports","leancloud-realtime"],b):b(a.AV=a.AV||{},a.AV)}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a.default:a}function d(a,b){return b={exports:{}},a(b,b.exports),b.exports}var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},f=d(function(a){var b=a.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=b)}),g=d(function(a){var b=a.exports={version:"2.4.0"};"number"==typeof __e&&(__e=b)}),h=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a},i=h,j=function(a,b,c){if(i(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}},k=function(a){return"object"==typeof a?null!==a:"function"==typeof a},l=k,m=function(a){if(!l(a))throw TypeError(a+" is not an object!");return a},n=function(a){try{return!!a()}catch(a){return!0}},o=!n(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),p=k,q=f.document,r=p(q)&&p(q.createElement),s=function(a){return r?q.createElement(a):{}},t=!o&&!n(function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}),u=k,v=function(a,b){if(!u(a))return a;var c,d;if(b&&"function"==typeof(c=a.toString)&&!u(d=c.call(a)))return d;if("function"==typeof(c=a.valueOf)&&!u(d=c.call(a)))return d;if(!b&&"function"==typeof(c=a.toString)&&!u(d=c.call(a)))return d;throw TypeError("Can't convert object to primitive value")},w=m,x=t,y=v,z=Object.defineProperty,A=o?Object.defineProperty:function(a,b,c){if(w(a),b=y(b,!0),w(c),x)try{return z(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a},B={f:A},C=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}},D=B,E=C,F=o?function(a,b,c){return D.f(a,b,E(1,c))}:function(a,b,c){return a[b]=c,a},G=f,H=g,I=j,J=F,K=function(a,b,c){var d,e,f,g=a&K.F,h=a&K.G,i=a&K.S,j=a&K.P,k=a&K.B,l=a&K.W,m=h?H:H[b]||(H[b]={}),n=m.prototype,o=h?G:i?G[b]:(G[b]||{}).prototype;h&&(c=b);for(d in c)(e=!g&&o&&void 0!==o[d])&&d in m||(f=e?o[d]:c[d],m[d]=h&&"function"!=typeof o[d]?c[d]:k&&e?I(f,G):l&&o[d]==f?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b.prototype=a.prototype,b}(f):j&&"function"==typeof f?I(Function.call,f):f,j&&((m.virtual||(m.virtual={}))[d]=f,a&K.R&&n&&!n[d]&&J(n,d,f)))};K.F=1,K.G=2,K.S=4,K.P=8,K.B=16,K.W=32,K.U=64,K.R=128;var L=K,M=L;M(M.S+M.F*!o,"Object",{defineProperty:B.f});var N=g.Object,O=function(a,b,c){return N.defineProperty(a,b,c)},P=d(function(a){a.exports={default:O,__esModule:!0}}),Q=d(function(a,b){b.__esModule=!0;var c=P,d=function(a){return a&&a.__esModule?a:{default:a}}(c);b.default=function(a,b,c){return b in a?(0,d.default)(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}}),R=c(Q),S={}.hasOwnProperty,T=function(a,b){return S.call(a,b)},U={}.toString,V=function(a){return U.call(a).slice(8,-1)},W=V,X=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==W(a)?a.split(""):Object(a)},Y=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a},Z=X,$=Y,_=function(a){return Z($(a))},aa=Math.ceil,ba=Math.floor,ca=function(a){return isNaN(a=+a)?0:(a>0?ba:aa)(a)},da=ca,ea=Math.min,fa=function(a){return a>0?ea(da(a),9007199254740991):0},ga=ca,ha=Math.max,ia=Math.min,ja=function(a,b){return a=ga(a),a<0?ha(a+b,0):ia(a,b)},ka=_,la=fa,ma=ja,na=f,oa=na["__core-js_shared__"]||(na["__core-js_shared__"]={}),pa=0,qa=Math.random(),ra=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++pa+qa).toString(36))},sa=function(a){return oa[a]||(oa[a]={})}("keys"),ta=ra,ua=T,va=_,wa=function(a){return function(b,c,d){var e,f=ka(b),g=la(f.length),h=ma(d,g);if(a&&c!=c){for(;g>h;)if((e=f[h++])!=e)return!0}else for(;g>h;h++)if((a||h in f)&&f[h]===c)return a||h||0;return!a&&-1}}(!1),xa=function(a){return sa[a]||(sa[a]=ta(a))}("IE_PROTO"),ya=function(a,b){var c,d=va(a),e=0,f=[];for(c in d)c!=xa&&ua(d,c)&&f.push(c);for(;b.length>e;)ua(d,c=b[e++])&&(~wa(f,c)||f.push(c));return f},za="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Aa=ya,Ba=za,Ca=Object.keys||function(a){return Aa(a,Ba)},Da=Object.getOwnPropertySymbols,Ea={f:Da},Fa={}.propertyIsEnumerable,Ga={f:Fa},Ha=Y,Ia=function(a){return Object(Ha(a))},Ja=Ca,Ka=Ea,La=Ga,Ma=Ia,Na=X,Oa=Object.assign,Pa=!Oa||n(function(){var a={},b={},c=Symbol(),d="abcdefghijklmnopqrst";return a[c]=7,d.split("").forEach(function(a){b[a]=a}),7!=Oa({},a)[c]||Object.keys(Oa({},b)).join("")!=d})?function(a,b){for(var c=Ma(a),d=arguments.length,e=1,f=Ka.f,g=La.f;d>e;)for(var h,i=Na(arguments[e++]),j=f?Ja(i).concat(f(i)):Ja(i),k=j.length,l=0;k>l;)g.call(i,h=j[l++])&&(c[h]=i[h]);return c}:Oa,Qa=L;Qa(Qa.S+Qa.F,"Object",{assign:Pa});var Ra=g.Object.assign,Sa=d(function(a){a.exports={default:Ra,__esModule:!0}}),Ta=c(Sa),Ua=d(function(a,b){!function(b){function c(a){var b=k(a);if(q)for(var c,d=0;c=t[d++];)a.hasOwnProperty(c)&&b.push(c);return b}function d(a,b,d){for(var e,f,h=c(d),i=0,j=h.length;i<j;)"__self"!==(e=h[i++])&&(f=d[e],!o(f)||f.prototype&&f.prototype.__self||g&&!(f.toString().indexOf(".__base")>-1)?b[e]=f:b[e]=function(c,d){var e=a[c]?a[c]:"__constructor"===c?b.__self.__parent:p,f=function(){var a=this.__base;this.__base=f.__base;var b=d.apply(this,arguments);return this.__base=a,b};return f.__base=e,f}(e,f))}function e(a,b){for(var c,d=1;c=a[d++];)b?o(c)?f.self(b,c.prototype,c):f.self(b,c):b=o(c)?f(a[0],c.prototype,c):f(a[0],c);return b||a[0]}function f(){var a=arguments,b=n(a[0]),c=b||o(a[0]),f=c?b?e(a[0]):a[0]:h,g=a[c?1:0]||{},i=a[c?2:1],k=g.__constructor||c&&f.prototype&&f.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:c?function(){return f.apply(this,arguments)}:function(){};if(!c)return k.prototype=g,k.prototype.__self=k.prototype.constructor=k,l(k,i);l(k,f),k.__parent=f;var m=f.prototype,p=k.prototype=j(m);return p.__self=p.constructor=k,g&&d(m,p,g),i&&d(f,k,i),k}var g=function(){return"_"}.toString().indexOf("_")>-1,h=function(){},i=Object.prototype.hasOwnProperty,j=Object.create||function(a){var b=function(){};return b.prototype=a,new b},k=Object.keys||function(a){var b=[];for(var c in a)i.call(a,c)&&b.push(c);return b},l=function(a,b){for(var c in b)i.call(b,c)&&(a[c]=b[c]);return a},m=Object.prototype.toString,n=Array.isArray||function(a){return"[object Array]"===m.call(a)},o=function(a){return"[object Function]"===m.call(a)},p=function(){},q=!0,r={toString:""};for(var s in r)r.hasOwnProperty(s)&&(q=!1);var t=q?["toString","valueOf"]:null;f.self=function(){var a=arguments,b=n(a[0]),c=b?e(a[0],a[0][0]):a[0],f=a[1],g=a[2],h=c.prototype;return f&&d(h,h,f),g&&d(c,c,g),c};var u=!0;a.exports=f,u=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(a){a(f)}),u=!1),u&&(b.inherit=f)}(e)}),Va=Ua;if(!b.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var Wa=Va(b.TypedMessage,{__constructor:function(a){this.__base(),this.timestamp=new Date(a)}});b.messageType(-101)(Wa),b.messageField(["timestamp"])(Wa),Wa.sendOptions={transient:!0};var Xa={name:"leancloud-realtime-plugin-groupchat-receipts",messageClasses:[Wa],onIMClientCreate:function(a){var b=a._sendReadCommand;a._sendReadCommand=function(c){for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return c.forEach(function(a){!a.transient&&a.members.length>2&&a.send(new Wa(a.lastMessageAt||new Date)).catch(function(a){return console.warn("Sending groupchat receipt fail: "+a.message)})}),b.call.apply(b,[a,c].concat(e))}},onConversationCreate:function(a){var b=a.queryMessages;a.queryMessages=function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return!a.transient&&a.members.length>2&&!a.lastReadTimestamps&&a._fetchAllReceiptTimestamps().then(function(b){a.lastReadTimestamps=b.reduce(function(a,b){var c=b.pid,d=b.lastReadAt;return Ta(a,R({},c,d))},{}),a.emit("lastreadtimestampsupdate",a.lastReadTimestamps)}).catch(function(a){return console.warn("Initialize group receipts fail: "+a.message)}),b.call.apply(b,[a].concat(d))}},beforeMessageDispatch:function(a,b){return a.type!==Wa.TYPE||(b.lastReadTimestamps&&(b.lastReadTimestamps[a.from]=a.timestamp,b.emit("lastreadtimestampsupdate",R({},a.from,a.timestamp))),!1)}};a.GroupchatReceiptsPlugin=Xa,a.ReadReceipt=Wa,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=groupchat-receipts.min.js.map